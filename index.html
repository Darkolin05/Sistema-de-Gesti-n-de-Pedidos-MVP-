<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Pedidos - MVP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100">

    <div id="root"></div>

    <!-- Incluye React, ReactDOM y Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">

        // Línea 18: SIMULACIÓN DE BACKEND: Menú de Platos 
        
        const MENU_PLATOS = [
            { id: 1, nombre: "Pizza", precio: 7000, categoria: "Pizzas", img: "https://placehold.co/40x40/f87171/ffffff?text=PZ" },
            { id: 2, nombre: "Hamburguesa Doble", precio: 20000, categoria: "Hamburguesas", img: "https://placehold.co/40x40/fbbf24/ffffff?text=HB" },
            { id: 3, nombre: "Ensalada", precio: 15000, categoria: "Ensaladas", img: "https://placehold.co/40x40/4ade80/ffffff?text=EN" },
            { id: 4, nombre: "Coca Cola", precio: 5000, categoria: "Bebidas", img: "https://placehold.co/40x40/3b82f6/ffffff?text=CC" },
            { id: 5, nombre: "Sopa del Día", precio: 10000, categoria: "Entrantes", img: "https://placehold.co/40x40/6366f1/ffffff?text=SO" },
            { id: 6, nombre: "Postre de chocolate", precio: 3500, categoria: "Postres", img: "https://placehold.co/40x40/f472b6/ffffff?text=CH" },
        ];

        // 1. CONTEXT API: Para gestión global del pedido
        
        // Contexto del Pedido
        const PedidoContexto = React.createContext();

        // Línea 37: Reductor para manejar la lógica compleja del pedido (añadir, eliminar, etc.)
        const pedidoReducer = (state, action) => {
            switch (action.type) {
                case 'AGREGAR_ITEM': {
                    const existingItem = state.items.find(item => item.id === action.payload.id);
                    if (existingItem) {
                        return {
                            ...state,
                            items: state.items.map(item =>
                                item.id === action.payload.id ? { ...item, cantidad: item.cantidad + 1 } : item
                            ),
                        };
                    }
                    return { ...state, items: [...state.items, { ...action.payload, cantidad: 1 }] };
                }
                case 'REMOVER_ITEM':
                    // Eliminar completamente el item por su ID
                    return { ...state, items: state.items.filter(item => item.id !== action.payload) };
                case 'FINALIZAR_PEDIDO':
                    // Simulación del backend: el pedido se envía y el estado se resetea
                    return { items: [], id: state.id + 1, mensaje: 'Pedido #' + state.id + ' enviado a cocina con éxito.' };
                case 'CANCELAR_PEDIDO':
                    // Resetea el pedido actual
                    return { items: [], id: state.id + 1, mensaje: 'Pedido Cancelado.' };
                default:
                    return state;
            }
        };

        // Componente Proveedor del Contexto
        const ProveedorPedido = ({ children }) => {
            // Estado para manejar mensajes de notificación
            const [mensaje, setMensaje] = React.useState(null); 
            // useReducer: Para manejar el estado principal del pedido
            const [pedido, dispatch] = React.useReducer(pedidoReducer, { items: [], id: 101, mensaje: '' });

            // Función para agregar ítems al pedido
            const agregarItem = (item) => {
                dispatch({ type: 'AGREGAR_ITEM', payload: item });
            };
            
            // Simulación de envío al "Backend"
            const enviarACocina = () => {
                // Se despacha la acción de finalizar, que actualiza el estado y el ID.
                dispatch({ type: 'FINALIZAR_PEDIDO' }); 
                setMensaje(`¡Pedido #${pedido.id} enviado a cocina! Nuevo pedido listo.`);
                setTimeout(() => setMensaje(null), 3000); // Ocultar mensaje después de 3s
            };

            // Función de Cancelación
            const cancelarPedido = () => {
                // Se despacha la acción de cancelar
                dispatch({ type: 'CANCELAR_PEDIDO' });
                setMensaje(`Pedido #${pedido.id} cancelado.`);
                setTimeout(() => setMensaje(null), 3000); // Ocultar mensaje después de 3s
            }

            // Valor que se proveerá al Contexto
            const valorContexto = { pedido, agregarItem, enviarACocina, cancelarPedido, mensaje };

            return (
                <PedidoContexto.Provider value={valorContexto}>
                    {children}
                </PedidoContexto.Provider>
            );
        };

        // 2. COMPONENTES: Modularizando la Interfaz

        // Componente de la Tarjeta de Producto
        const TarjetaProducto = ({ producto }) => {
            // useContext: Contexto para acceder a la función agregarItem
            const { agregarItem } = React.useContext(PedidoContexto);
            return (
                <div 
                    className="bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition cursor-pointer flex flex-col justify-between"
                    onClick={() => agregarItem(producto)} // Acción principal
                >
                    <img src={producto.img} alt={producto.nombre} className="w-12 h-12 mx-auto mb-2 rounded-full border-2 border-gray-200"/>
                    <h3 className="text-sm font-semibold text-center truncate">{producto.nombre}</h3>
                    <p className="text-xs text-center text-gray-600 font-bold mt-1">${producto.precio.toLocaleString('es-CO')}</p>
                </div>
            );
        };

        // Componente del Resumen del Pedido (Carrito)
        const ResumenPedido = () => {
            // useContext: Contexto para acceder al estado del pedido y acciones
            const { pedido, enviarACocina, cancelarPedido } = React.useContext(PedidoContexto);

            // Cálculo de totales
            const subtotal = pedido.items.reduce((acc, item) => acc + item.precio * item.cantidad, 0);
            const impuestos = subtotal * 0.10; // 10% de impuesto simulado
            const total = subtotal + impuestos;

            const formatoCOP = (monto) => {
                return monto.toLocaleString('es-CO', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            }

            return (
                <div className="bg-gray-800 p-6 rounded-lg shadow-xl h-full flex flex-col text-white">
                    <h2 className="text-2xl font-bold mb-4 border-b border-gray-600 pb-2">RESUMEN PEDIDO #{pedido.id}</h2>

                    <div className="flex-grow overflow-y-auto space-y-3">
                        {pedido.items.length === 0 ? (
                            <p className="text-gray-400 italic">Aún no hay platos en el pedido.</p>
                        ) : (
                            pedido.items.map(item => (
                                <div key={item.id} className="flex justify-between items-center text-sm bg-gray-700 p-2 rounded">
                                    <span className="font-semibold">{item.cantidad}x {item.nombre}</span>
                                    <span>${formatoCOP(item.precio * item.cantidad)}</span>
                                </div>
                            ))
                        )}
                    </div>

                    <div className="mt-6 pt-4 border-t border-gray-600 space-y-1">
                        <div className="flex justify-between text-base">
                            <span>Subtotal:</span>
                            <span>${formatoCOP(subtotal)}</span>
                        </div>
                        <div className="flex justify-between text-base">
                            <span>Impuestos (10%):</span>
                            <span>${formatoCOP(impuestos)}</span>
                        </div>
                        <div className="flex justify-between text-2xl font-extrabold text-yellow-400">
                            <span>TOTAL:</span>
                            <span>${formatoCOP(total)}</span>
                        </div>
                    </div>

                    <div className="mt-6 space-y-2">
                        {/* Botón de acción principal: Simula la interacción con el Backend */}
                        <button 
                            onClick={enviarACocina}
                            disabled={pedido.items.length === 0}
                            className={`w-full py-3 rounded-lg font-bold transition duration-200 ${
                                pedido.items.length > 0
                                ? 'bg-green-600 hover:bg-green-700 shadow-lg'
                                : 'bg-gray-500 cursor-not-allowed'
                            }`}
                        >
                            ENVIAR A COCINA
                        </button>
                        {/* Botón de Cancelar Pedido (Resetea el carrito) */}
                        <button 
                            onClick={cancelarPedido}
                            disabled={pedido.items.length === 0}
                            className={`w-full py-3 rounded-lg font-bold transition duration-200 ${
                                pedido.items.length > 0
                                ? 'bg-red-600 hover:bg-red-700 shadow-lg'
                                : 'bg-gray-500 cursor-not-allowed'
                            }`}
                        >
                            CANCELAR PEDIDO
                        </button>
                    </div>
                </div>
            );
        };

        // Componente de la Mesa (para la vista de Gestión de Mesas)
        const TarjetaMesa = ({ id, estado, personas, color }) => (
            <div className={`p-4 rounded-lg shadow-lg cursor-pointer transition transform hover:scale-[1.02] ${color}`}>
                <h3 className="text-xl font-bold">Mesa #{id}</h3>
                <p className="text-sm mt-1">Estado: {estado}</p>
                <p className="text-sm">Personas: {personas}</p>
                <button className="mt-3 bg-white text-gray-800 px-3 py-1 rounded-full text-xs font-semibold hover:bg-gray-200">
                    {estado === 'Libre' ? 'Abrir Pedido' : 'Ver Pedido'}
                </button>
            </div>
        );

        // Línea 335: Componente para mostrar la Información del Proyecto
        const InformacionProyecto = () => (
            <>
                <h1 className="text-3xl font-bold text-gray-800 mb-6">INFORMACIÓN DEL PROYECTO</h1>
                <div className="bg-white p-6 rounded-lg shadow-md">
                    <h2 className="text-xl font-semibold mb-3 text-blue-700">Sistema Integrado de Gestión de Pedidos y Control de Inventario</h2>
                    <p className="mb-4 text-gray-700">
                        Este sistema es una herramienta de gestión integrada, diseñada para automatizar y optimizar los procesos de toma de pedidos y control de inventario en el sector restaurantero, tal como se plantea en la documentación del proyecto.
                    </p>
                    <p className="mb-4 text-gray-700 font-medium">
                        **Objetivo Principal:** Reducir la toma manual de pedidos, minimizar errores de inventario y mejorar la velocidad de atención al cliente, incrementando la rentabilidad y satisfacción.
                    </p>
                    <h3 className="text-lg font-semibold mt-4 text-gray-800">Tecnologías Clave</h3>
                    <ul className="list-disc list-inside text-gray-600 ml-4">
                        <li>**React.js:** Usado para la interfaz de usuario dinámica y modular.</li>
                        <li>**Context API:** Para la gestión de estado del pedido global (carrito).</li>
                        <li>**Tailwind CSS:** Para estilos rápidos y responsivos.</li>
                    </ul>
                </div>
            </>
        );

        // Datos simulados para la vista de mesas
        const DATOS_MESAS = [
            { id: 1, estado: 'Ocupada', personas: 4, color: 'bg-red-400 text-white' },
            { id: 2, estado: 'Libre', personas: 2, color: 'bg-green-400 text-white' },
            { id: 3, estado: 'Pago Pendiente', personas: 3, color: 'bg-yellow-400 text-gray-800' },
            { id: 4, estado: 'Libre', personas: 6, color: 'bg-green-400 text-white' },
            { id: 5, estado: 'Ocupada', personas: 1, color: 'bg-red-400 text-white' },
        ];
        
        // Datos simulados para la vista de historial
        const DATOS_HISTORIAL = [
            { id: 100, cliente: 'Mesa 5', fecha: '2025-11-20', total: 45000, estado: 'Pagado' },
            { id: 99, cliente: 'Para llevar (J. Pérez)', fecha: '2025-11-19', total: 22000, estado: 'Pagado' },
            { id: 98, cliente: 'Mesa 1', fecha: '2025-11-19', total: 60000, estado: 'Cancelado' },
        ];


        // 3. COMPONENTE PRINCIPAL (Main Layout)

        const App = () => {
            // Línea 394: useState: Simula la navegación entre vistas
            const [vistaActual, setVistaActual] = React.useState('pedido');
            const { mensaje } = React.useContext(PedidoContexto);

            // useEffect: Simula la obtención inicial de datos
            React.useEffect(() => {
                console.log("Aplicación Iniciada. useEffect ejecutado para cargar datos iniciales del menú.");
                // Aquí iría la llamada a la API real
            }, []);

            const renderizarContenido = () => {
                switch (vistaActual) {
                    case 'pedido':
                        return (
                            <>
                                <h1 className="text-3xl font-bold text-gray-800 mb-4">TOMA DE PEDIDO</h1>
                                <div className="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mb-6">
                                    <input type="text" placeholder="Mesa [01]" className="p-3 border rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full sm:w-1/3"/>
                                    <button className="bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition font-semibold w-full sm:w-auto">Para Llevar</button>
                                </div>
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 overflow-y-auto flex-grow pb-4">
                                    {MENU_PLATOS.map(producto => (
                                        <TarjetaProducto key={producto.id} producto={producto} />
                                    ))}
                                </div>
                            </>
                        );
                    case 'mesas':
                        // Interfaz de Gestión de Mesas implementada
                        return (
                            <>
                                <h1 className="text-3xl font-bold text-gray-800 mb-6">GESTIÓN DE MESAS</h1>
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                                    {DATOS_MESAS.map(mesa => (
                                        <TarjetaMesa key={mesa.id} {...mesa} />
                                    ))}
                                </div>
                            </>
                        );
                    case 'historial':
                        // Interfaz de Historial de Pedidos implementada
                        return (
                            <>
                                <h1 className="text-3xl font-bold text-gray-800 mb-6">HISTORIAL DE PEDIDOS</h1>
                                <div className="bg-white p-6 rounded-lg shadow-md overflow-x-auto">
                                    <table className="min-w-full divide-y divide-gray-200">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"># Pedido</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mesa/Cliente</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                            </tr>
                                        </thead>
                                        <tbody className="bg-white divide-y divide-gray-200">
                                            {DATOS_HISTORIAL.map(ped => (
                                                <tr key={ped.id} className="hover:bg-gray-50">
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{ped.id}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{ped.cliente}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{ped.fecha}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-semibold text-green-600">${ped.total.toLocaleString('es-CO')}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${ped.estado === 'Pagado' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                            {ped.estado}
                                                        </span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </>
                        );
                    case 'info': // Línea 486: Nuevo caso para la vista de Información
                        return <InformacionProyecto />;
                    default:
                        return null;
                }
            };

            return (
                <div className="flex h-screen bg-gray-900">
                    {/* Barra Lateral de Navegación (Router Simulado) */}
                    <nav className="w-20 sm:w-64 bg-gray-800 text-white flex flex-col p-4 shadow-2xl">
                        <div className="text-xl font-bold mb-8 text-yellow-400 hidden sm:block">RESTAURANTE POS</div>
                        <ul className="space-y-4 flex flex-col items-center sm:items-stretch">
                            {/* Simulación de Rutas y Navegación con useState */}
                            {['pedido', 'mesas', 'historial', 'info'].map(item => (
                                <li key={item}>
                                    <button 
                                        onClick={() => setVistaActual(item)}
                                        className={`w-full p-3 rounded-lg text-center capitalize transition duration-150 ${
                                            vistaActual === item 
                                            ? 'bg-blue-600 font-bold' 
                                            : 'hover:bg-gray-700'
                                        }`}
                                    >
                                        <span className='hidden sm:inline'>{item.toUpperCase()}</span>
                                        <span className='sm:hidden'>{item.slice(0, 1).toUpperCase()}</span>
                                    </button>
                                </li>
                            ))}
                        </ul>
                    </nav>

                    {/* Contenido Principal y Resumen del Pedido */}
                    <main className="flex flex-1 overflow-hidden">
                        {/* Sección de Contenido Dinámico */}
                        <section className="flex flex-col flex-grow p-6 sm:p-8 bg-gray-100 overflow-y-auto">
                            {renderizarContenido()}
                        </section>

                        {/* Columna Fija de Resumen del Pedido (Carrito) */}
                        <aside className="w-full sm:w-96 flex-shrink-0 bg-gray-800 shadow-xl">
                            <ResumenPedido />
                        </aside>
                    </main>

                    {/* Mensaje de Éxito */}
                    {mensaje && (
                        <div className="absolute top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-xl font-bold transition-opacity duration-300">
                            {mensaje}
                        </div>
                    )}
                </div>
            );
        };

        // Renderizado del componente principal
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        // El componente App debe estar envuelto en el Provider para acceder al Contexto
        root.render(<ProveedorPedido><App /></ProveedorPedido>);
    </script>
</body>
</html>
